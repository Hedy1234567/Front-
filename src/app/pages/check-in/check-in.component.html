<button class="back-btn" (click)="goBack()">← Back to Home</button>

<form [formGroup]="checkInForm" (ngSubmit)="onSubmit()">
  <h1>Hotel Check-In</h1>

  <div>
    <label for="fullName">Full Name</label>
    <input id="fullName" type="text" formControlName="fullName" />
    <div class="error-message" *ngIf="formControls['fullName'].touched && formControls['fullName'].invalid">
      Name must be at least 3 characters.
    </div>
  </div>

  <div>
    <label for="email">Email</label>
    <input id="email" type="email" formControlName="email" />
    <div class="error-message" *ngIf="formControls['email'].touched && formControls['email'].invalid">
      Valid email is required.
    </div>
  </div>

  <div>
    <label for="phoneNumber">Phone Number</label>
    <input id="phoneNumber" type="text" formControlName="phoneNumber" />
    <div class="error-message" *ngIf="formControls['phoneNumber'].touched && formControls['phoneNumber'].invalid">
      Valid phone number is required.
    </div>
  </div>

  <div>
    <label for="bookingReference">Booking Reference</label>
    <input id="bookingReference" type="text" formControlName="bookingReference" />
  </div>

  <div class="date-group">
    <div>
      <label for="checkInDate">Check-in Date</label>
      <input id="checkInDate" type="date" formControlName="checkInDate" />
    </div>
    <div>
      <label for="checkOutDate">Check-out Date</label>
      <input id="checkOutDate" type="date" formControlName="checkOutDate" />
    </div>
  </div>

  <div>
    <label for="numberOfGuests">Number of Guests</label>
    <input id="numberOfGuests" type="number" formControlName="numberOfGuests" />
  </div>

  <div>
    <label for="idType">ID Type</label>
    <select id="idType" formControlName="idType">
      <option value="" disabled selected>Select ID Type</option>
      <option value="passport">Passport</option>
      <option value="driverLicense">Driver's License</option>
    </select>
  </div>

  <!-- Removed ID number field -->

  <div>
    <label for="roomType">Room Type</label>
    <select id="roomType" formControlName="roomType">
      <option value="" disabled selected>Select Room Type</option>
      <option value="single">Single</option>
      <option value="double">Double</option>
      <option value="suite">Suite</option>
    </select>
  </div>

  <fieldset>
    <legend>Preferences</legend>
    <div class="checkbox-group">
      <label><input type="checkbox" formControlName="nonSmoking" /> Non-Smoking Room</label>
      <label><input type="checkbox" formControlName="highFloor" /> High Floor</label>
      <label><input type="checkbox" formControlName="nearElevator" /> Near Elevator</label>
    </div>
  </fieldset>

  <fieldset>
    <legend>Extras</legend>
    <div class="checkbox-group">
      <label><input type="checkbox" formControlName="breakfast" /> Breakfast</label>
      <label><input type="checkbox" formControlName="airportPickup" /> Airport Pickup</label>
      <label><input type="checkbox" formControlName="spaAccess" /> Spa Access</label>
      <label><input type="checkbox" formControlName="lateCheckout" /> Late Checkout</label>
    </div>
  </fieldset>

  <div>
    <label for="specialRequests">Special Requests</label>
    <textarea id="specialRequests" formControlName="specialRequests"></textarea>
  </div>

  <div class="terms">
    <input type="checkbox" id="agreeTerms" formControlName="agreeTerms" />
    <label for="agreeTerms">I agree to the terms and conditions</label>
  </div>

 
  <!-- ✅ Carte Bancaire Upload -->
  <div>
    <label for="rectoUpload">Upload Front Card</label>
    <input type="file" id="rectoUpload" (change)="onRectoSelected($event)" accept="image/*" />
  </div>
  <div>
    <label for="versoUpload">Upload Back Card</label>
    <input type="file" id="versoUpload" (change)="onVersoSelected($event)" accept="image/*" />
  </div>

  <div *ngIf="rectoText === 'Extraction en cours...'">
    <span style="color: #1976d2; font-weight: bold;">Extraction in progress...</span>
  </div>

  <!-- Affichage des données extraites du recto sous forme de labels -->
  <div *ngIf="apiCardData">
    <div><strong>Card Number :</strong> <span *ngIf="apiCardData.num_carte; else noNum">{{ apiCardData.num_carte }}</span><ng-template #noNum><em style="color:red">Non détecté</em></ng-template></div>
    <div><strong>Expiration Date :</strong> <span *ngIf="apiCardData.date_expiration; else noDate">{{ apiCardData.date_expiration }}</span><ng-template #noDate><em style="color:red">Non détectée</em></ng-template></div>
    <div><strong>Card Security Code :</strong> <span *ngIf="apiCardData.cvv; else noCvv">{{ apiCardData.cvv }}</span><ng-template #noCvv><em style="color:red">Non détecté</em></ng-template></div>
    <div><strong>Cardholder :</strong> <span *ngIf="apiCardData.titulaire; else noTitulaire">{{ apiCardData.titulaire }}</span><ng-template #noTitulaire><em style="color:red">Non détecté</em></ng-template></div>
  </div>

  <button type="submit" [disabled]="checkInForm.invalid">Submit</button>
</form>

<nav>
  <a routerLink="/hotels" *ngIf="isAdmin()">🏨 Hotels</a>
  <a routerLink="/clients">👤 Clients</a>
  <a routerLink="/reservations">📅 Reservations</a>
  <a routerLink="/Marketplace">🛍️ Marketplace</a>
  <a [routerLink]="['/role']" *ngIf="isAdmin()">👥 Roles</a>
  <a routerLink="/user" *ngIf="isAdmin()">👤 Users</a>
  <a routerLink="/login" class="logout-link">🔓 Logout</a>
</nav>